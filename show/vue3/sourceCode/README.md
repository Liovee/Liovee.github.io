# VUE3 源码思考

### 虚拟diff算法

##### 虚拟dom
1.虚拟DOM就是通过JS来生成一个AST节点树

![avatar](../../fonts/vue3-source1.png)

2.dom属性非常多，操作dom成本比较高

3.算法(无key)
![avatar](../../fonts/vue3-source2.png)
![avatar](../../fonts/vue3-source3.png)
```
通过patch重新渲染元素,简而言之就是一个一个替换
```
![avatar](../../fonts/vue3-source4.png)
```
如果发现多了就删除，少了就新增
```
(有key)
```
1.首先会使用前序算法比较新旧节点的type和key是否是一样的,type是元素标签,div之类
```
```
2.如果发现节点有不一致则跳出循环 采用尾序算法进行比较
```

```
3.前序和后续对比完如果发现有多，就新增
```
```
4.如果发现有少，就卸载
```
```
5.如果新旧节点是无序情况
```

```
先对旧节点按照key进行一个排序，再构建key和index的一个索引[key:3=>index:0;key:2=>index:1;key:1=>index:2]
```
```
构建新节点在旧节点中的位置数组，接着判断如果有多余的节点就进行删除，如果新节点不包含旧节点也进行删除，，如果节点出现交叉，就去求最长递增子序列
```

```
求最长递增子序列升序
如果遍历的节点不在子序列中就去移动，如果在子序列中就跳过
```